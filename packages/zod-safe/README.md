# zod-safe

<p>
  <a href="https://github.com/sorgloomer/ts-typesafe-decorators/actions?query=branch%3Amaster"><img src="https://github.com/sorgloomer/ts-typesafe-decorators/actions/workflows/test.yml/badge.svg?event=push&branch=master" alt="Test" /></a>
  <a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://img.shields.io/github/license/sorgloomer/ts-typesafe-decorators" alt="License"></a>
</p>

<div>
  <a href="https://github.com/sorgloomer/ts-typesafe-decorators/tree/master/packages/zod-safe">GitHub</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://www.npmjs.com/package/zod-safe">npm</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://github.com/sorgloomer/ts-typesafe-decorators/issues/new">Issues</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://twitter.com/hege_hegedus">@hege_hegedus</a>
  <br />
</div>

Helper types to make sure a [zod](https://zod.dev/?id=basic-usage) schema exactly matches a given interface.

Particularly useful when the types are defined in another package, managed by someone else or generated by some tool,
and the source does not provide a way to parse/validate objects against the type.


## Example usage

Install

```shell
npm i --save zod-safe
```

Check a zod schema in an expression

```typescript
import { Exactly, ZodSafe } from 'zod-safe';
import * as z from 'zod';

export interface ContactDto {
  id: number;
  name?: string;
}

export const ContactSchema = ZodSafe(
  z.object({
    id: z.number().int(),
    name: z.string(),
    // Oops, we forgot optional!
  })
).infer<Exactly<ContactDto>>();
//      ^^^^^^^^^^^^^^^^^^^
//  The types of 'get().name' are incompatible between these types.
//  Type 'string | undefined' is not assignable to type 'string'.
```

Or validate the schema in a separate statement

```typescript
ZodSafe(ContactSchema).infer<Exactly<ContactDto>>();
//                           ^^^^^^^^^^^^^^^^^^^
```

### Fine-grained type assertion example

```typescript
import { Extends, Super, ZodSafe } from 'zod-safe';
import * as z from 'zod';

export interface TransferDto {
  amount: string;
  description?: string;
}

export interface TransferEntity {
  amount?: bigint;
  description?: string;
}

export const TransferSchema = z.object({
  amount: z.string().transform(BigInt).optional(),
  description: z.string().optional(),
});

ZodSafe(TransferSchema).matches<{
  input: Super<TransferDto>,
  output: Extends<TransferEntity>,
}>();
```


## Similar projects

- [`tsafe`](https://github.com/garronej/tsafe) : also allows for checking strict type equality for `zod`, but does not
  produce nice error messages
